name: Launch GUI Script V2

on: 
  workflow_dispatch:

env:
  #SCRIPT_TO_RUN: "C:\\Users\\Mariano\\Documents\\DMV Automation - 10 Jun V2\\Test2.py"
  SCRIPT_TO_RUN: "C:\\Users\\Mariano\\Documents\\DMV Automation - 10 Jun V2\\One_new-Copy2 (2).py"

jobs:
  launch:
    runs-on: [self-hosted, windows, gui]
    defaults: 
      run: 
        shell: powershell

    steps:
      - name: Configurar acción de LanzarAppGUI (con log)
        run: |
          $py  = (Get-Command python.exe).Source
          if (-not (Test-Path $py)) { throw "No se encontró python.exe" }

          $script  = "${{ env.SCRIPT_TO_RUN }}"
          $logDir  = "C:\Scripts\logs"
          New-Item -ItemType Directory -Force -Path $logDir | Out-Null
          $ts      = Get-Date -Format 'yyyyMMdd_HHmmss'
          $logFile = Join-Path $logDir ("script_" + $ts + ".log")

          # Construimos el comando completo y luego lo metemos entre comillas para /c
          $cmd = '"{0}" "{1}" > "{2}" 2>&1' -f $py, $script, $logFile
          $args = '/c "' + $cmd + '"'

          $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument $args
          Set-ScheduledTask -TaskName "LanzarAppGUI" -Action $action

          Write-Host "Script configurado: $script"
          Write-Host "Log configurado en: $logFile"

      - name: Disparar LanzarAppGUI
        run: |
          $t = New-ScheduledTaskTrigger -Once -At ((Get-Date).AddSeconds(5))
          Set-ScheduledTask -TaskName "LanzarAppGUI" -Trigger $t
          Start-ScheduledTask -TaskName "LanzarAppGUI"
          Write-Host "Listo: se lanzó ${{ env.SCRIPT_TO_RUN }}"
