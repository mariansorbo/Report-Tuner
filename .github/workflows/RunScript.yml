name: Launch GUI Script

on: 
  workflow_dispatch:

env:
  #SCRIPT_TO_RUN: "C:\\Users\\Mariano\\Documents\\DMV Automation - 10 Jun V2\\Test2.py"
  # Cambia a:
  SCRIPT_TO_RUN: "C:\\Users\\Mariano\\Documents\\DMV Automation - 10 Jun V2\\One_new.py"

jobs:
  launch:
    runs-on: [self-hosted, windows, gui]
    defaults: { run: { shell: powershell } }

    steps:
      - name: Configurar acción de LanzarAppGUI
        run: |
          $pyw  = (Get-Command python.exe).Source -replace 'python.exe$','pythonw.exe'
          if (-not (Test-Path $pyw)) { throw "No se encontró pythonw.exe" }

          $script = "${{ env.SCRIPT_TO_RUN }}"
          Write-Host "Configurando LanzarAppGUI para: $script"

          $action = New-ScheduledTaskAction -Execute $pyw -Argument "`"$script`""
          Set-ScheduledTask -TaskName "LanzarAppGUI" -Action $action

      - name: Disparar LanzarAppGUI
        run: |
          $t = New-ScheduledTaskTrigger -Once -At ((Get-Date).AddSeconds(5))
          Set-ScheduledTask -TaskName "LanzarAppGUI" -Trigger $t
          Start-ScheduledTask -TaskName "LanzarAppGUI"
          Write-Host "Listo: se lanzó ${{ env.SCRIPT_TO_RUN }}"
